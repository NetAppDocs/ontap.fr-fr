---
permalink: consistency-groups/index.html 
sidebar: sidebar 
keywords: consistency group protection, application protection, metrocluster, write-order, application management, workload 
summary: Un groupe de cohérence est un ensemble de volumes organisés comme une unité unique, ce qui facilite la gestion et la protection des charges de travail couvrant plusieurs volumes ou LUN. 
---
= Présentation des groupes de cohérence
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
Un groupe de cohérence est un ensemble de volumes gérés comme une seule unité. Dans ONTAP, les groupes de cohérence simplifient la gestion et garantissent la protection d'une charge de travail applicative couvrant plusieurs volumes.

Pour simplifier la gestion du stockage, vous pouvez utiliser des groupes de cohérence. Imaginez que vous disposez d'une base de données importante couvrant 20 LUN. Vous pouvez gérer les LUN de manière individuelle ou les traiter comme un jeu de données unique, les organiser au sein d'un même groupe de cohérence.

Les groupes de cohérence facilitent la gestion des charges de travail des applications en fournissant des règles de protection locales et distantes facilement configurées, ainsi que des copies Snapshot cohérentes au niveau des applications ou après panne d'un ensemble de volumes à un point dans le temps. Les snapshots des groupes de cohérence permettent de restaurer toute une charge de travail applicative.



== Comprendre les groupes de cohérence

Les groupes de cohérence prennent en charge n'importe quel volume FlexVol, quel que soit le protocole (NAS, SAN ou NVMe). Ils peuvent être gérés via l'API REST de ONTAP ou dans System Manager, dans l'élément de menu *stockage > groupes de cohérence*.

Les groupes de cohérence peuvent exister sous la forme d'entités individuelles, sous la forme d'un ensemble de volumes, ou dans une relation hiérarchique constituée d'autres groupes de cohérence. Les volumes individuels peuvent disposer de leur propre règle Snapshot granulaire par volume. En outre, il peut exister des règles Snapshot à l'échelle du groupe de cohérence. Le groupe de cohérence ne peut avoir qu'une seule relation SnapMirror Business Continuity (SM-BC) et une politique SM-BC partagée, qui peut être utilisée pour restaurer l'ensemble du groupe de cohérence.

Le graphique suivant illustre l'utilisation possible d'un groupe de cohérence individuel. Données d'une application hébergée sur `SVM1` s'étend sur deux volumes : `vol1` et `vol2`. Sur le groupe de cohérence, une règle Snapshot capture des snapshots des données toutes les 15 minutes.

image:../media/consistency-group-single-diagram.gif["Diagramme d'un seul groupe de cohérence avec ses volumes constitutifs et sa règle Snapshot locale"]

Des charges de travail applicatives plus importantes peuvent nécessiter plusieurs groupes de cohérence. Dans ce cas, vous pouvez créer des groupes de cohérence hiérarchiques, où un seul groupe de cohérence devient les composants enfants d'un groupe de cohérence parent. Le groupe de cohérence parent peut inclure au maximum cinq groupes de cohérence enfant. Comme dans les groupes de cohérence individuels, une stratégie de protection SM-BC distante peut être appliquée à la configuration complète des groupes de cohérence (parents et enfants) pour restaurer la charge de travail de l'application.

Dans l'exemple suivant, une application est hébergée sur `SVM1`. L'administrateur a créé un groupe de cohérence parent, `SVM1_app`, qui inclut deux groupes de cohérence enfant : `SVM1appDataCG` pour les données et `SVM1app_logCG` pour les journaux. Chaque groupe de cohérence enfant dispose de sa propre politique de snapshot. Snapshots des volumes dans `SVM1appDataCG` sont prises toutes les 15 minutes. Snapshots de `SVM1app_logCG` sont prises toutes les heures. Groupe de cohérence parent `SVM1_app` Dispose d'une politique SM-BC qui réplique les données pour assurer un service continu en cas d'incident.

image:../media/consistency-group-nested-diagram.gif["Diagramme d'un groupe de cohérence imbriqué avec les volumes associés"]

Depuis la version ONTAP 9.12.1, les groupes de cohérence sont pris en charge xref:clone-task.html[clonage] et en modifiant les membres de la cohérence par xref:modify-task.html[ajout ou suppression de volumes] Dans System Manager et dans l'API REST de ONTAP. Depuis ONTAP 9.12.1, l'API REST de ONTAP prend également en charge :

* Création de groupes de cohérence avec de nouveaux volumes NFS ou SMB ou espaces de noms NVMe.
* Ajout de volumes NFS ou SMB ou d'espaces de noms NVMe nouveaux ou existants à des groupes de cohérence existants.


Pour plus d'informations sur l'API REST de ONTAP, reportez-vous à https://["Documentation de référence de l'API REST ONTAP"].



== Surveillez les groupes de cohérence

À partir de la version ONTAP 9.13.1, les groupes de cohérence assurent le contrôle de la capacité et des performances en temps réel et historiques, offrant ainsi un aperçu des performances des applications et des groupes de cohérence individuels.

Les données de surveillance de groupe de cohérence sont conservées pendant un an maximum. Vous pouvez suivre les mesures pour :

* Performances : IOPS, latence et débit
* Capacité : taille, capacité disponible, capacité utilisée



NOTE: Vous ne pouvez récupérer des metrics historiques qu'avec l'API REST. Les indicateurs historiques ne sont pas visibles dans System Manager.



== Protégez les groupes de cohérence

La protection est assurée par des groupes de cohérence :

* Règles relatives aux snapshots
* xref:../smbc/index.html[Continuité de l'activité SnapMirror (SM-BC)]
* <<mcc>> (début 9.11.1)
* xref:../data-protection/snapmirror-disaster-recovery-concept.html[Réplication asynchrone SnapMirror] (début 9.13.1)


La création d'un groupe de cohérence n'active pas automatiquement la protection. Il est possible de définir des règles de protection locale et à distance lors de la création ou après la création d'un groupe de cohérence.

Pour configurer la protection sur un groupe de cohérence, reportez-vous à la section link:protect-task.html["Protéger un groupe de cohérence"].

Pour utiliser la protection à distance, vous devez répondre aux exigences de xref:../smbc/smbc_plan_prerequisites.html#licensing[Déploiements de continuité de l'activité SnapMirror].


NOTE: Les relations SM-BC ne peuvent pas être établies sur les volumes montés pour l'accès NAS.



== Balises d'application et de composant

Depuis ONTAP 9.12.1, les groupes de cohérence prennent en charge le balisage des composants et des applications. Les balises d'application et de composant sont un outil de gestion qui vous permet de filtrer et d'identifier différentes charges de travail dans vos groupes de cohérence.

Il existe deux types de balises :

* **Balises d'application** : elles s'appliquent aux groupes de cohérence individuel et parent. Les balises d'application fournissent un étiquetage pour les charges de travail telles que MongoDB, Oracle ou SQL Server. La balise d'application par défaut pour les groupes de cohérence est autre.
* **Balises de composant**: Les enfants des groupes de cohérence hiérarchiques ont des balises de composant au lieu de balises d'application. Les options pour les balises de composant sont « données », « journaux » ou « autre ». La valeur par défaut est autre.


Lors de la création de groupes de cohérence ou après la création de groupes de cohérence, vous pouvez appliquer les balises. Si le groupe de cohérence possède une relation SM-BC, vous devez utiliser *Other* comme balise d'application ou de composant.



== Groupes de cohérence dans les configurations MetroCluster

Depuis ONTAP 9.11.1, vous pouvez provisionner les groupes de cohérence avec de nouveaux volumes sur un cluster dans une configuration MetroCluster. Ces volumes sont provisionnés sur des agrégats en miroir.

Une fois ces agrégats provisionnés, vous pouvez déplacer les volumes associés aux groupes de cohérence entre les agrégats en miroir et non mis en miroir. Les volumes associés à des groupes de cohérence peuvent donc être situés sur des agrégats en miroir, des agrégats sans mise en miroir, ou les deux. Vous pouvez modifier les agrégats en miroir contenant des volumes associés à des groupes de cohérence pour ne plus mettre en miroir. De même, vous pouvez modifier les agrégats non mis en miroir contenant les volumes associés à des groupes de cohérence pour activer la mise en miroir.

Les volumes associés et les snapshots associés aux groupes de cohérence placés sur des agrégats en miroir sont répliqués sur le site distant (site B). Le contenu des volumes sur le site B garantit l'ordre d'écriture du groupe de cohérence, ce qui vous permet d'effectuer une restauration depuis le site B en cas d'incident. Vous pouvez accéder aux snapshots de groupes de cohérence répliqués via une API REST de groupe de cohérence Snapshot et System Manager sur des clusters exécutant ONTAP 9.11.1 ou une version ultérieure.

Si certains ou l'ensemble des volumes associés à un groupe de cohérence se trouvent sur des agrégats non mis en miroir qui ne sont pas actuellement accessibles, LES opérations D'OBTENTION ou DE SUPPRESSION du groupe de cohérence se comportent comme si les volumes locaux ou les agrégats d'hébergement sont hors ligne.



=== Configurations de groupes de cohérence pour la réplication

Si le site B exécute ONTAP 9.10.1 ou une version antérieure, seuls les volumes associés aux groupes de cohérence situés sur les agrégats en miroir sont répliqués sur le site B. Les configurations de groupes de cohérence sont uniquement répliquées vers le site B, si les deux sites exécutent ONTAP 9.11.1 ou une version ultérieure. Une fois le site B mis à niveau vers ONTAP 9.11.1, les données destinées aux groupes de cohérence du site A où tous leurs volumes associés sont répliqués sur le site B.



== Mise à niveau

Les groupes de cohérence créés avec SM-BC dans ONTAP 9.8 et 9.9.1 seront automatiquement mis à niveau et gérables sous *stockage > groupes de cohérence* dans System Manager ou l'API REST ONTAP lors de la mise à niveau vers ONTAP 9.10.1 ou version ultérieure. Pour plus d'informations sur la mise à niveau à partir de ONTAP 9.8 ou 9.9.1, reportez-vous à la section link:../smbc/smbc_admin_upgrade_and_revert_considerations.html["Considérations relatives à la mise à niveau et à la restauration de SM-BC"].

Snapshots de groupes de cohérence l'API REST ONTAP peut être gérée via l'interface de groupes de cohérence de System Manager et les terminaux d'API REST de groupe de cohérence.


NOTE: Snapshots créés avec les commandes ONTAPI `cg-start` et `cg-commit` Ne seront pas reconnus comme des snapshots de groupe de cohérence et ne pourront donc pas être gérés via l'interface de groupe de cohérence de System Manager ou les terminaux de groupe de cohérence de l'API REST ONTAP.



== Fonctionnalités prises en charge par version

[cols="3,1,1,1,1"]
|===
|  | ONTAP 9.13.1 | ONTAP 9.12.1 | ONTAP 9.11.1 | ONTAP 9.10.1 


| Groupes de cohérence hiérarchiques | X | X | X | X 


| Protection Snapshot locale | X | X | X | X 


| Continuité de l'activité SnapMirror | X | X | X | X 


| Prise en charge de MetroCluster | X | X | X |  


| Validations en deux phases (API REST uniquement) | X | X | X |  


| Balises d'application et de composant | X | X |  |  


| Cloner des groupes de cohérence | X | X |  |  


| Ajouter et supprimer des volumes | X | X |  |  


| Créez un CGS avec de nouveaux volumes NAS | X | API REST uniquement |  |  


| Créez un CGS avec les nouveaux espaces de noms NVMe | X | API REST uniquement |  |  


| Déplacez des volumes entre des groupes de cohérence enfants | X |  |  |  


| Modifier la géométrie du groupe de cohérence | X |  |  |  


| Contrôle | X |  |  |  


| SnapMirror asynchrone (groupes de cohérence uniques uniquement) | X |  |  |  
|===


== En savoir plus sur les groupes de cohérence

video::j0jfXDcdyzE[youtube,width=848,height=480]
.Plus d'informations
* link:https://docs.netapp.com/us-en/ontap-automation/["Documentation sur l'automatisation ONTAP"^]
* xref:../smbc/index.html[Continuité de l'activité SnapMirror]
* xref:../data-protection/snapmirror-disaster-recovery-concept.html[Principes de base de la reprise sur incident asynchrone SnapMirror]
* link:https://docs.netapp.com/us-en/ontap-metrocluster/["Documentation MetroCluster"]

