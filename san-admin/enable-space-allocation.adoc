---
permalink: san-admin/enable-space-allocation.html 
sidebar: sidebar 
keywords: enable, space allocation, space reclamation, unmap 
summary: 'Si vous définissez l"option d"allocation d"espace sur activé, ONTAP notifie l"hôte lorsque l"espace du volume est insuffisant et la LUN du volume ne peut pas accepter les écritures. Cette option permet également à ONTAP de récupérer automatiquement de l"espace lorsque votre hôte supprime des données.' 
---
= Activez l'allocation d'espace pour SAN
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
Si votre hôte FC ou iSCSI prend en charge le provisionnement fin SCSI, vous pouvez activer l'allocation d'espace.  Lorsque l'allocation d'espace est activée et qu'un volume est à court d'espace, la LUN du volume reste en ligne et est définie en mode lecture seule.  L'hôte est alors averti que la LUN ne peut plus accepter les écritures.  Si l'allocation d'espace n'est pas prise en charge sur votre hôte ou si elle n'est pas activée, lorsqu'un volume est à court d'espace et qu'il ne peut pas croître automatiquement, ONTAP met la LUN hors ligne.

De même, lorsque l'allocation d'espace est activée, la gestion de l'espace côté hôte identifie les blocs de données qui ont été supprimés sur le système de fichiers hôte et en émet automatiquement un ou plusieurs `SCSI UNMAP` Commandes pour libérer les blocs correspondants sur le système de stockage et permettre à ONTAP de récupérer de l'espace.

.Avant de commencer
Pour activer l'allocation d'espace, le provisionnement fin SCSI doit être pris en charge par votre hôte. Le provisionnement fin SCSI utilise le provisionnement de blocs logiques tel que défini dans la norme SCSI SBC-3. Seuls les hôtes prenant en charge cette norme peuvent utiliser le provisionnement fin SCSI dans ONTAP.

Les hôtes suivants prennent actuellement en charge le provisionnement fin SCSI lorsque vous activez l'allocation d'espace :

* Citrix XenServer 6.5 et versions ultérieures
* ESXi 5.0 et versions ultérieures
* Noyau Oracle Linux 6.2 UEK et versions ultérieures
* Red Hat Enterprise Linux 6.2 et versions ultérieures
* SUSE Linux Enterprise Server 11 et versions ultérieures
* Solaris 11.1 et versions ultérieures
* Répertoires de base


L'allocation d'espace n'est pas prise en charge sur les hôtes NVMe.

.Description de la tâche
À partir de ONTAP 9.15.1, l'allocation d'espace est activée par défaut pour les LUN VMware et Hyper-V nouvellement créées, et elle est désactivée pour toutes les LUN qui viennent d'être créées et qui ne sont pas utilisées par VMware et Hyper-V.


NOTE: Lorsque vous mettez à niveau votre cluster vers ONTAP 9.15.1, le paramètre d'allocation d'espace pour toutes les LUN créées avant la mise à niveau logicielle reste le même après la mise à niveau, quel que soit le type d'hôte.  Par exemple, si une LUN a été créée dans ONTAP 9.13.1 pour un hôte VMware dont l'allocation d'espace est désactivée, l'allocation d'espace sur cette LUN reste désactivée après la mise à niveau vers ONTAP 9.15.1.

Vous devez mettre la LUN hors ligne pour activer l'allocation d'espace. Vous devez ensuite effectuer une découverte sur l'hôte avant que l'hôte ne reconnaisse que l'allocation d'espace a été activée.

.Étapes
. Mettre la LUN hors ligne :
+
[source, cli]
----
lun modify -vserver vserver_name -volume volume_name -lun lun_name -state offline
----
. Activer l'allocation d'espace :
+
[source, cli]
----
lun modify -vserver _vserver_name_ -volume _volume_name_ -lun _lun_name_ -space-allocation enabled
----
. Vérifiez que l'allocation d'espace est activée :
+
[source, cli]
----
lun show -vserver _vserver_name_ -volume _volume_name_ -lun _lun_name_ -fields space-allocation
----
. Mettre la LUN en ligne :
+
[source, cli]
----
lun modify -vserver _vserver_name_ -volume _volume_name_ -lun _lun_name_ -state online
----
. Sur l'hôte, relancez l'analyse de tous les disques pour vous assurer que la modification apportée à l' `-space-allocation` l'option est correctement découverte.

