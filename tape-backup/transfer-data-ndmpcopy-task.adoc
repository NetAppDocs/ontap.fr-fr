---
permalink: tape-backup/transfer-data-ndmpcopy-task.html 
sidebar: sidebar 
keywords: transfer, data, ndmpcopy, incremental, full, qtree, directory, files, v4, ndmp 
summary: La commande ndmpcopy transfère les données entre les systèmes de stockage prenant en charge NDMP v4. Vous pouvez effectuer des transferts de données complets et incrémentiels. Vous pouvez transférer des volumes complets ou partiels, des qtrees, des répertoires ou des fichiers individuels. 
---
= Transférer des données ONTAP à l'aide de ndmpcopy
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
Le `ndmpcopy` La commande nodeshell transfère les données entre les systèmes de stockage qui prennent en charge NDMP v4. Vous pouvez effectuer des transferts de données complets et incrémentiels. Vous pouvez transférer des volumes complets ou partiels, des qtrees, des répertoires ou des fichiers individuels.

.Description de la tâche
Avec ONTAP 8.x et les versions antérieures, les transferts incrémentiels sont limités à deux niveaux au maximum (une sauvegarde complète et jusqu'à deux sauvegardes incrémentielles).

Depuis la version ONTAP 9.0 et les versions ultérieures, les transferts incrémentiels se limitent à neuf niveaux maximum (une sauvegarde complète et jusqu'à neuf sauvegardes incrémentielles).

Vous pouvez exécuter `ndmpcopy` à la ligne de commande nodeshell des systèmes de stockage source et de destination, ou d'un système de stockage qui n'est ni la source ni la destination du transfert de données. Vous pouvez également exécuter `ndmpcopy` sur un système de stockage unique qui est à la fois la source et la destination du transfert de données.

Vous pouvez utiliser les adresses IPv4 ou IPv6 des systèmes de stockage source et de destination dans `ndmpcopy` commande. Le format du chemin d'accès est `/vserver_name/volume_name \[path\]`.



.Étapes
. Activer le service NDMP sur les systèmes de stockage source et cible :
+
|===


| Si vous effectuez le transfert des données à la source ou à la destination dans... | Utiliser la commande suivante... 


 a| 
Mode SVM-scoped NDMP
 a| 
`vserver services ndmp on`

[NOTE]
====
Pour l'authentification NDMP au SVM admin, le compte utilisateur est `admin` et le rôle de l'utilisateur est `admin` ou `backup`. Au sein de la SVM de données, le compte utilisateur est `vsadmin` et le rôle de l'utilisateur est `vsadmin` ou `vsadmin-backup` rôle.

====


 a| 
Mode node-scoped NDMP
 a| 
`system services ndmp on`

|===
. Transfert de données au sein d'un système de stockage ou entre des systèmes de stockage utilisant le `ndmpcopy` commande au nodeshell :
+
`::> system node run -node <node_name> < ndmpcopy [options] source_IP:source_path destination_IP:destination_path [-mcs {inet|inet6}] [-mcd {inet|inet6}] [-md {inet|inet6}]`

+
[NOTE]
====
Les noms DNS ne sont pas pris en charge dans ndmpcopy. Vous devez fournir l'adresse IP de la source et de la destination. L'adresse de bouclage (127.0.0.1) n'est pas prise en charge pour l'adresse IP source ou l'adresse IP de destination.

====
+
** Le `ndmpcopy` commande détermine le mode d'adresse pour les connexions de contrôle comme suit :
+
*** Le mode d'adresse pour la connexion de contrôle correspond à l'adresse IP fournie.
*** Vous pouvez remplacer ces règles à l'aide du `-mcs` et `-mcd` options.


** Si la source ou la destination est le système ONTAP, selon le mode NDMP (node-scoped ou SVM-scoped), utiliser une adresse IP permettant d'accéder au volume cible.
** `source_path` et `destination_path` sont les noms de chemin absolus jusqu'au niveau granulaire du volume, qtree, répertoire ou fichier.
** `-mcs` spécifie le mode d'adressage préféré pour la connexion de contrôle au système de stockage source.
+
`inet` Indique un mode d'adresse IPv4 et `inet6` Indique un mode d'adresse IPv6.

** `-mcd` spécifie le mode d'adressage préféré pour la connexion de contrôle au système de stockage de destination.
+
`inet` Indique un mode d'adresse IPv4 et `inet6` Indique un mode d'adresse IPv6.

** `-md` spécifie le mode d'adressage préféré pour les transferts de données entre les systèmes de stockage source et de destination.
+
`inet` Indique un mode d'adresse IPv4 et `inet6` Indique un mode d'adresse IPv6.

+
Si vous n'utilisez pas le `-md` dans le `ndmpcopy` commande, le mode d’adressage de la connexion de données est déterminé comme suit :

+
*** Si l'une des adresses spécifiées pour les connexions de contrôle est une adresse IPv6, le mode d'adresse de la connexion de données est IPv6.
*** Si les deux adresses spécifiées pour les connexions de contrôle sont des adresses IPv4, le `ndmpcopy` La commande tente d'abord de passer en mode d'adresse IPv6 pour la connexion de données.
+
Si cela échoue, la commande utilise un mode d'adresse IPv4.

+
[NOTE]
====
Une adresse IPv6, si elle est spécifiée, doit être entre crochets.

====
+
Cet exemple de commande migre les données d'un chemin source (`source_path`) vers un chemin de destination (`destination_path`).

+
[listing]
----
> ndmpcopy -sa admin:<ndmp_password> -da admin:<ndmp_password>
 -st md5 -dt md5 192.0.2.129:/<src_svm>/<src_vol> 192.0.2.131:/<dst_svm>/<dst_vol>
----
+
Cet exemple de commande définit explicitement les connexions de contrôle et la connexion de données pour utiliser le mode d'adresse IPv6 :

+
[listing]
----
> ndmpcopy -sa admin:<ndmp_password> -da admin:<ndmp_password> -st md5 -dt md5 -mcs inet6 -mcd inet6 -md
 inet6 [2001:0db8:1:1:209:6bff:feae:6d67]:/<src_svm>/<src_vol> [2001:0ec9:1:1:200:7cgg:gfdf:7e78]:/<dst_svm>/<dst_vol>
----






Pour en savoir plus sur les commandes décrites dans cette procédurelink:https://docs.netapp.com/us-en/ontap-cli/["Référence de commande ONTAP"^], reportez-vous à la .



== Options de la commande ndmpcopy

Vous devez comprendre les options disponibles pour que la `ndmpcopy` commande nodeshell réussisse link:transfer-data-ndmpcopy-task.html["transfert de données"].

Le tableau suivant répertorie les options disponibles.

|===
| Option | Description 


 a| 
`-sa` `username`:[`password`]
 a| 
Cette option définit le nom d'utilisateur et le mot de passe d'authentification source pour la connexion au système de stockage source. Cette option est obligatoire.

Pour un utilisateur sans privilège admin, vous devez spécifier le mot de passe spécifique NDMP généré par le système de l'utilisateur. Le mot de passe généré par le système est obligatoire pour les utilisateurs admin et non-admin.



 a| 
`-da` `username`:[`password`]
 a| 
Cette option définit le nom d'utilisateur et le mot de passe d'authentification de destination pour la connexion au système de stockage de destination. Cette option est obligatoire.



 a| 
`-st` {`md5`|`text`}
 a| 
Cette option définit le type d'authentification source à utiliser lors de la connexion au système de stockage source. Il s'agit d'une option obligatoire. L'utilisateur doit donc fournir l'une ou l'autre `text` ou `md5` option.



 a| 
`-dt` {`md5`|`text`}
 a| 
Cette option définit le type d'authentification de destination à utiliser lors de la connexion au système de stockage de destination.



 a| 
`-l`
 a| 
Cette option définit le niveau de vidage utilisé pour le transfert vers la valeur spécifiée de niveau.les valeurs valides sont `0`, `1`, à `9`, où `0` indique un transfert complet et `1` à `9` spécifie un transfert incrémentiel. La valeur par défaut est `0`.



 a| 
`-d`
 a| 
Cette option permet de générer des messages de journal de débogage ndmpcopy. Les fichiers journaux de débogage ndmpcopy se trouvent dans le `/mroot/etc/log` volume racine. Les noms des fichiers journaux de débogage ndmpcopy se trouvent dans le `ndmpcopy.yyyymmdd` format.



 a| 
`-f`
 a| 
Cette option active le mode forcé. Ce mode permet d'écraser les fichiers système dans `/etc` Répertoire à la racine du volume 7-mode.



 a| 
`-h`
 a| 
Cette option imprime le message d'aide.



 a| 
`-p`
 a| 
Cette option vous invite à saisir le mot de passe pour l'autorisation source et de destination. Ce mot de passe remplace le mot de passe spécifié pour `-sa` et `-da` options.

[NOTE]
====
Vous ne pouvez utiliser cette option que lorsque la commande s'exécute dans une console interactive.

====


 a| 
`-exclude`
 a| 
Cette option exclut les fichiers ou répertoires spécifiés du chemin spécifié pour le transfert de données. La valeur peut être une liste de noms de répertoire ou de fichier séparés par des virgules, tels que `*.pst` ou `*.txt`. Le nombre maximum de modèles d'exclusion pris en charge est de 32 et le nombre maximum de caractères pris en charge est de 255.

|===