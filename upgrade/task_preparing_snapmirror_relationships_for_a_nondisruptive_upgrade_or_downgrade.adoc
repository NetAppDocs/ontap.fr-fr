---
permalink: upgrade/task_preparing_snapmirror_relationships_for_a_nondisruptive_upgrade_or_downgrade.html 
sidebar: sidebar 
keywords: ontap, upgrade, snapmirror, operations, quisce 
summary: 'Nous vous recommandons d"arrêter vos opérations SnapMirror avant d"effectuer une mise à niveau sans interruption de ONTAP.' 
---
= Préparez les relations SnapMirror en vue d'une mise à niveau ONTAP
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
Avant de mettre à niveau ONTAP sur un cluster exécutant SnapMirror, les opérations SnapMirror doivent être suspendues pour chaque nœud contenant des volumes de destination et chaque SVM peering doit avoir un nom unique sur les clusters. Il est recommandé d'utiliser un nom de domaine complet (FQDN) unique pour chaque SVM, par exemple, « dataVerser.HQ » ou « mirrorVserver.hors site ».

Notez également que si vous mettez à niveau des clusters avec des relations DP SnapMirror, vous devez mettre à niveau les nœuds de destination avant de mettre à niveau les nœuds source.



== Arrêter les opérations SnapMirror avant de mettre à niveau ONTAP

Pour éviter toute défaillance des transferts SnapMirror, vous devez arrêter les opérations SnapMirror. Vous pouvez également arrêter les transferts SnapMirror sur un volume de destination spécifique et mettre à niveau le nœud de destination propriétaire avant de mettre à niveau les nœuds source. Les transferts SnapMirror pour tous les autres volumes de destination peuvent ainsi continuer. Le tableau ci-dessous décrit les deux options permettant de suspendre les opérations SnapMirror.

[cols="3*"]
|===
| Option | Description | Mettre à niveau les nœuds de destination avant les nœuds source ? 


 a| 
Suspendre les opérations SnapMirror pendant toute la durée de la mise à niveau sans interruption.
 a| 
La méthode la plus simple pour la mise à niveau dans un environnement SnapMirror consiste à interrompre toutes les opérations SnapMirror, à effectuer la mise à niveau, puis à reprendre les opérations SnapMirror. Cependant, aucun transfert SnapMirror n'aura lieu pendant l'ensemble de la mise à niveau sans interruption. Vous devez utiliser cette méthode si votre cluster contient des nœuds qui sont des volumes en miroir les uns sur les autres.
 a| 
Non, les nœuds peuvent être mis à niveau dans n'importe quel ordre.



 a| 
Suspendre les opérations SnapMirror pour un volume de destination à la fois.
 a| 
Vous pouvez interrompre les transferts SnapMirror pour un volume de destination spécifique, mettre à niveau le nœud (ou une paire HA) contenant le volume de destination, mettre à niveau le nœud (ou une paire HA) contenant le volume source, puis reprendre les transferts SnapMirror pour le volume de destination. Cette méthode permet de continuer les transferts SnapMirror pour tous les autres volumes de destination pendant la mise à niveau des nœuds contenant les volumes de destination et source d'origine.
 a| 
Oui.

|===
.Étapes
. Déterminer le chemin de destination pour chaque relation SnapMirror :
+
[source, cli]
----
snapmirror show
----
. Pour chaque volume de destination, suspendre les futurs transferts SnapMirror :
+
[source, cli]
----
snapmirror quiesce -destination-path destination
----
+
Si aucun transfert actif n'est attribué à la relation SnapMirror, cette commande définit son état sur « suspendu ». Si la relation dispose de transferts actifs, l'état est défini sur « mise en veille » jusqu'à ce que le transfert soit terminé, puis l'état devient « suspendu ».

+
Dans cet exemple, les transferts sont suspendus impliquant le volume de destination « vol1 » de « SVMvs0.example.com":

+
[listing]
----
cluster1::> snapmirror quiesce -destination-path vs0.example.com:vol1
----
. Vérifiez que toutes les relations SnapMirror sont suspendues :
+
`snapmirror show -status !Quiesced`

+
Cette commande affiche toutes les relations SnapMirror qui sont _pas_ suspendues.

+
Dans cet exemple, toutes les relations SnapMirror sont suspendues :

+
[listing]
----
cluster1::> snapmirror show -status !Quiesced
There are no entries matching your query.
----
. Si des relations SnapMirror sont actuellement transférées, effectuer l'une des options suivantes :
+
[cols="2*"]
|===
| Option | Description 


 a| 
Attendez la fin des transferts avant d'effectuer la mise à niveau de ONTAP.
 a| 
Une fois le transfert terminé, la relation passe à l'état « suspendu ».



 a| 
Arrêter les transferts :

`snapmirror abort -destination-path destination -h`

*Remarque :* vous devez utiliser le `-foreground true` paramètre si vous mettez fin aux transferts miroir de partage de charge.
 a| 
Cette commande arrête le transfert SnapMirror et restaure le volume de destination vers la dernière copie Snapshot qui a été transférée. La relation est définie sur l'état « suspendu ».

|===

